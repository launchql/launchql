language: node_js
notifications:
  email: false
cache:
  yarn: true
  directories:
    - node_modules
node_js:
  - "10"
  - "12"
services:
  - docker
env:
  global:
    - MINIO_ACCESS_KEY=minio-access
    - MINIO_SECRET_KEY=minio-secret
    - AWS_ACCESS_KEY=minio-access
    - AWS_SECRET_KEY=minio-secret
    - MINIO_ENDPOINT=http://localhost:9000
    - BUCKET_NAME=testbucket
  matrix:
    - PACKAGE=packages/content-type-stream
    - PACKAGE=packages/s3-streamer
    - PACKAGE=packages/s3-utils
    - PACKAGE=packages/stream-to-s3
    - PACKAGE=packages/upload-names
before_install:
  - docker run -p 9000:9000 -e "MINIO_ACCESS_KEY=minio-access" -e "MINIO_SECRET_KEY=minio-secret" --name minio -d minio/minio server /data
script:
  - yarn
  - yarn bootstrap
  - yarn build
  - cd $PACKAGE
  - yarn test
